import{gsap as s}from"https://esm.sh/gsap@3.12.2";import*as a from"https://esm.sh/three@0.157.0";import{GLTFLoader as Z}from"https://esm.sh/three@0.157.0/examples/jsm/loaders/GLTFLoader.js";import{OrbitControls as K}from"https://esm.sh/three@0.157.0/examples/jsm/controls/OrbitControls.js";import{EffectComposer as J}from"https://esm.sh/three@0.157.0/examples/jsm/postprocessing/EffectComposer.js";import{RenderPass as Q}from"https://esm.sh/three@0.157.0/examples/jsm/postprocessing/RenderPass.js";import{UnrealBloomPass as ee}from"https://esm.sh/three@0.157.0/examples/jsm/postprocessing/UnrealBloomPass.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();function y(e,t,n,i,o="x",r=1,c=.5,D=.5,V=.5){const X=t.isActive(),$=t.paused();["x","y","z"].includes(o)||(console.warn(`Invalid axis "${o}" passed to toggleSpin. Defaulting to 'x'.`),o="x"),r=Math.sign(r)||1;const H=e.rotation[o];X||!$?(t.clear().to(e.rotation,{[o]:H+r*Math.PI/2,duration:D,ease:"power1.out",onComplete:()=>{t.pause(),n("idle",i)}}).play(),n("decelerating",i)):(t.clear().to(e.rotation,{[o]:H+r*Math.PI,duration:c,ease:"power1.in"}).to(e.rotation,{[o]:`+=${r*Math.PI*2}`,duration:V,ease:"linear",repeat:-1}).play(),n("spinning",i))}function te(e,t){const n=new a.DirectionalLight(16777215,2);n.position.set(5,10,10),n.castShadow=!0,e.add(n);const i=new a.DirectionalLight(16777215,.5);i.position.set(-5,2,5),e.add(i);const o=new a.DirectionalLight(16777215,1);o.position.set(0,5,-10),e.add(o);const r=new a.AmbientLight(4473924,.2);e.add(r);const c=new a.DirectionalLight(16777215,2);return c.position.set(0,-5,0),c.target.position.set(0,0,0),e.add(c),e.add(c.target),t.shadowMap.enabled=!0,{key:n,fill:i,rim:o,ambient:r,upLight:c}}const O=new a.Scene,l=new a.PerspectiveCamera(50,innerWidth/innerHeight,.01,1e3),u=new a.WebGLRenderer({antialias:!1});u.setPixelRatio(window.devicePixelRatio);u.setSize(innerWidth,innerHeight);const ne=new Z,p=s.timeline({}),h=s.timeline({}),oe=new Q(O,l),z=new J(u);z.addPass(oe);const ie=new ee(new a.Vector2(window.innerWidth,window.innerHeight),.5,1.4,.5);z.addPass(ie);let re=new Map;var L,T,C,v,R,P,b,I,A=!0,E=!0;const ae=document.getElementById("wetRollerButton"),se=s.timeline({paused:!0,repeat:-1,ease:"power1.inOut"}),le=document.getElementById("brushBarButton"),ce=s.timeline({paused:!0,repeat:-1,ease:"power1.inOut"}),de=document.getElementById("sideCleanerButton"),ue=s.timeline({paused:!0,repeat:-1,ease:"power1.inOut"}),pe=s.timeline({paused:!0,repeat:-1,ease:"power1.inOut"}),fe=document.getElementById("wheelsButton"),me=s.timeline({paused:!0,repeat:-1,ease:"power1.inOut"}),ge=s.timeline({paused:!0,repeat:-1,ease:"power1.inOut"}),k={sideCleanerButton:()=>N("external"),wheelsButton:()=>W("external"),wetRollerButton:()=>j("external"),brushBarButton:()=>_("external"),btn2:()=>G(),btn5:()=>q()};function F(e,t){if(!e)return console.warn("No action name provided for triggerModelAction."),!1;const n=k[e];return typeof n!="function"?(console.warn(`No handler found for action "${e}".`),!1):(n(t),!0)}window.Dyson3DControls={triggerAction:F,availableActions:()=>Object.keys(k)};window.addEventListener("message",e=>{var o,r;const{data:t}=e;let n,i;if(typeof t=="string")n=t;else if(t&&typeof t=="object"){if(t.type&&t.type!=="MODEL_ACTION")return;n=(r=(o=t.action)!=null?o:t.modelAction)!=null?r:t.id,i=t.payload}typeof n=="string"&&F(n,i)});O.background=new a.Color(1118481);u.setSize(innerWidth,innerHeight);u.setPixelRatio(devicePixelRatio);u.domElement.id="myCanvas";document.body.appendChild(u.domElement);window.addEventListener("resize",()=>{const e=window.innerWidth,t=window.innerHeight;l.aspect=e/t,l.updateProjectionMatrix(),u.setSize(e,t),u.setPixelRatio(window.devicePixelRatio)});var d=new K(l,u.domElement);d.minDistance=.5;d.maxDistance=1;l.position.z=1.5;l.position.x=0;l.position.y=5;u.toneMapping=a.ACESFilmicToneMapping;u.toneMappingExposure=1.22;u.shadowMap.enabled=!0;u.outputColorSpace=a.SRGBColorSpace;let M=document.createElement("video");M.src="./glb/cordfree/LCD_battery.mp4";M.loop=!0;let B=new a.VideoTexture(M);B.format=a.RGBFormat;B.minFilter=a.NearestFilter;B.maxFilter=a.NearestFilter;B.generateMipmaps=!1;var we=new a.PlaneGeometry(.0271,.0271),ye=new a.MeshBasicMaterial({map:B}),x=new a.Mesh(we,ye);x.rotateX(0-Math.PI*.5);x.rotateZ(0-Math.PI*1);x.translateZ(.141);x.translateY(.146);const g=te(O,u);g.key.intensity=0;g.fill.intensity=0;g.rim.intensity=0;g.ambient.intensity=0;ne.load("./glb/robot/804_A_test_001.glb",e=>{let t=1;e.scene.scale.x=t,e.scene.scale.y=t,e.scene.scale.z=t,O.add(e.scene),L=e.scene.getObjectByName(f("rotor brush null A")),T=e.scene.getObjectByName(f("rotor brush null B")),C=e.scene.getObjectByName(f("SB-430273_AA - WET ROLLER ASSY_43089")),v=e.scene.getObjectByName(f("SB-430272_AA - DUST BOX ASSY")),R=e.scene.getObjectByName(f("SB-430287_AA - TRACTION WHEEL ASSY_30408")),P=e.scene.getObjectByName(f("SB-430287_AA - TRACTION WHEEL ASSY_38412")),b=e.scene.getObjectByName(f("SB-430273_AA - WET ROLLER ASSY_37478")),I=e.scene.getObjectByName(f("SB-430275_AA - BRUSHBAR ASSY_22072")),e.scene.getObjectByName(f("SB-430279_AA - FRONT WHEEL ASSY_5505")),e.scene.getObjectByName(f("SB-430287_AA - TRACTION WHEEL ASSY_41617")),he()});Y();function Y(){requestAnimationFrame(Y),z.render()}function w(e,t=16777215){e.traverse(n=>{if(n.isMesh){n.material=n.material.clone(),n.material.emissive=new a.Color(n.material.color),n.material.emissiveIntensity=0;const i=s.fromTo(n.material,{emissiveIntensity:5,duration:.8,ease:"sine.inOut"},{emissiveIntensity:0,duration:.8,ease:"sine.inOut"});re.set(n,i)}})}function he(){s.to(g.key,{intensity:2,duration:1}),s.to(g.fill,{intensity:.5,duration:1,delay:.2}),s.to(g.rim,{intensity:1,duration:1,delay:.4}),s.to(g.ambient,{intensity:.2,duration:1,delay:.6});const e=s.timeline();p.to(l.position,{id:"openingAnimation",duration:3,x:0,y:-1.5,z:1.75,ease:"power2.inOut",onUpdate:function(){d.update()}}),e.call(()=>{N()},null,2.25),e.call(()=>{j()},null,1.75),e.call(()=>{W()},null,2),e.call(()=>{_()},null,2.25)}function f(e){return e.replace(/ /g,"_")}addEventListener("mousemove",e=>{e.clientX/innerWidth*2-1,-(e.clientY/innerHeight)*2+1});function S(){if(l.position.y>.1){const e=Be(l);e.tweening?(console.log("Camera is tweening to:",e.target),e.target&&e.target.x===0&&e.target.y===-1.5&&e.target.z===1.75?console.log("Camera is tweening to starting position"):(p.clear(),p.to(l.position,{duration:1.5,x:0,y:-1.5,z:1.75,overwrite:"true",ease:"power1.inOut",onUpdate:function(){d.update()}}))):(console.log("Camera is idle."),p.clear(),p.to(l.position,{duration:1.5,x:0,y:-1.5,z:1.75,overwrite:"true",ease:"power1.inOut",onUpdate:function(){d.update()}}))}U()}function Be(e){var n,i,o;const t=s.getTweensOf(e.position);for(const r of t)if(r.isActive()){const c=r.vars;return{tweening:!0,target:{x:(n=c.x)!=null?n:e.position.x,y:(i=c.y)!=null?i:e.position.y,z:(o=c.z)!=null?o:e.position.z}}}return{tweening:!1,target:null}}var ve=document.getElementById("btn2");ve.addEventListener("click",G);var be=document.getElementById("btn5");be.addEventListener("click",q);de.addEventListener("click",e=>{N(e)});function N(e){e instanceof Event&&(w(L,16711680),w(T)),y(L,ue,m,"sideCleanerButton","y"),y(T,pe,m,"sideCleanerButton","y",-1),S()}le.addEventListener("click",e=>{_(e)});function _(e){e instanceof Event&&w(I),y(I,ce,m,"brushBarButton","x"),S()}ae.addEventListener("click",e=>{j(e)});function j(e){e instanceof Event&&w(C),y(C,se,m,"wetRollerButton","x",-1,.75,.75,1.5),S()}fe.addEventListener("click",e=>{W(e)});function W(e){e instanceof Event&&(w(R),w(P)),y(R,me,m,"wheelsButton","x",1,1,1,3),y(P,ge,m,"wheelsButton","x",1,1,1,3),S()}function G(e){var n,i;p.clear(),h.clear(),w(v);const t=(i=(n=e==null?void 0:e.currentTarget)==null?void 0:n.id)!=null?i:"btn2";A==!0?(s.to(v.position,{duration:1.4,z:-300,ease:"power1.inOut",delay:.5}),p.to(l.position,{overwrite:"true",duration:1.5,x:-3,y:3,z:1,ease:"power1.inOut",onUpdate:function(){d.update()}}),h.to(d.target,{overwrite:"true",duration:1.5,x:0,y:.2,z:0,ease:"power1.inOut",onUpdate:function(){d.update()}}),A=!1,m("spinning",t)):(s.to(v.position,{duration:1.75,z:0,ease:"power1.inOut"}),p.to(l.position,{overwrite:"true",duration:1.75,x:-6,y:3,z:1,ease:"power1.inOut",delay:0,onUpdate:function(){d.update()}}),U(),A=!0,m("idle",t))}function q(e){var n,i;w(b),p.clear(),h.clear();const t=(i=(n=e==null?void 0:e.currentTarget)==null?void 0:n.id)!=null?i:"btn5";E==!0?(s.to(b.position,{duration:1.4,x:400,ease:"power1.inOut"}),p.to(l.position,{overwrite:"true",duration:1.5,x:-.4,y:4,z:1.4,ease:"power1.inOut",onUpdate:function(){d.update()}}),h.to(d.target,{overwrite:"true",duration:1.5,x:-.4,y:-.25,z:-.1,ease:"power1.inOut",onUpdate:function(){d.update()}}),E=!1,m("spinning",t)):(s.to(b.position,{duration:1.2,x:0,ease:"power1.inOut"}),p.to(l.position,{overwrite:"true",duration:1.2,x:-6,y:3,z:1,ease:"power1.inOut",onUpdate:function(){d.update()}}),U(),E=!0,m("idle",t))}function U(e=1.5){h.clear(),h.to(d.target,{overwrite:"true",duration:e,x:0,y:0,z:0,ease:"power1.inOut",delay:0,onUpdate:function(){d.update()}})}function m(e,t){const i=document.getElementById(t).querySelector(".circle");i.classList.remove("idle","spinning","decelerating"),i.classList.add(e)}
