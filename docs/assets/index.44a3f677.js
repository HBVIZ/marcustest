import{gsap as s}from"https://esm.sh/gsap@3.12.2";import*as a from"https://esm.sh/three@0.157.0";import{GLTFLoader as se}from"https://esm.sh/three@0.157.0/examples/jsm/loaders/GLTFLoader.js";import{OrbitControls as le}from"https://esm.sh/three@0.157.0/examples/jsm/controls/OrbitControls.js";import{EffectComposer as ce}from"https://esm.sh/three@0.157.0/examples/jsm/postprocessing/EffectComposer.js";import{RenderPass as de}from"https://esm.sh/three@0.157.0/examples/jsm/postprocessing/RenderPass.js";import{UnrealBloomPass as ue}from"https://esm.sh/three@0.157.0/examples/jsm/postprocessing/UnrealBloomPass.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();function g(e,o,t,i,n="x",r=1,c=.5,W=.5,ie=.5){const ae=o.isActive(),re=o.paused();["x","y","z"].includes(n)||(console.warn(`Invalid axis "${n}" passed to toggleSpin. Defaulting to 'x'.`),n="x"),r=Math.sign(r)||1;const U=e.rotation[n];ae||!re?(o.clear().to(e.rotation,{[n]:U+r*Math.PI/2,duration:W,ease:"power1.out",onComplete:()=>{o.pause(),t("idle",i)}}).play(),t("decelerating",i)):(o.clear().to(e.rotation,{[n]:U+r*Math.PI,duration:c,ease:"power1.in"}).to(e.rotation,{[n]:`+=${r*Math.PI*2}`,duration:ie,ease:"linear",repeat:-1}).play(),t("spinning",i))}function fe(e,o){const t=new a.DirectionalLight(16777215,2);t.position.set(5,10,10),t.castShadow=!0,e.add(t);const i=new a.DirectionalLight(16777215,.5);i.position.set(-5,2,5),e.add(i);const n=new a.DirectionalLight(16777215,1);n.position.set(0,5,-10),e.add(n);const r=new a.AmbientLight(4473924,.2);e.add(r);const c=new a.DirectionalLight(16777215,2);return c.position.set(0,-5,0),c.target.position.set(0,0,0),e.add(c),e.add(c.target),o.shadowMap.enabled=!0,{key:t,fill:i,rim:n,ambient:r,upLight:c}}const pe="./glb/robot/test-spoot.glb",T=.03,k=.2,me=4473924,we=16777215,ye=4473924,he=.6,L=.8,p=new a.Scene,l=new a.PerspectiveCamera(50,innerWidth/innerHeight,.01,1e3),u=new a.WebGLRenderer({antialias:!1});u.setPixelRatio(window.devicePixelRatio);u.setSize(innerWidth,innerHeight);const ge=new se,f=s.timeline({}),v=s.timeline({}),ve=new de(p,l),z=new ce(u);z.addPass(ve);const Le=new ue(new a.Vector2(window.innerWidth,window.innerHeight),.5,1.4,.5);z.addPass(Le);let Oe=new Map;var N,I,P,x,_,M,A,H,b=!0,R=!0;const xe=document.querySelector('[data-model-action="wetRollerButton"]'),Ae=s.timeline({paused:!0,repeat:-1,ease:"power1.inOut"}),Be=document.querySelector('[data-model-action="brushBarButton"]'),Ee=s.timeline({paused:!0,repeat:-1,ease:"power1.inOut"}),Te=document.querySelector('[data-model-action="sideCleanerButton"]'),be=s.timeline({paused:!0,repeat:-1,ease:"power1.inOut"}),Re=s.timeline({paused:!0,repeat:-1,ease:"power1.inOut"}),Se=document.querySelector('[data-model-action="wheelsButton"]'),Ce=s.timeline({paused:!0,repeat:-1,ease:"power1.inOut"}),Ne=s.timeline({paused:!0,repeat:-1,ease:"power1.inOut"}),Y={sideCleanerButton:()=>J(),wheelsButton:()=>te(),wetRollerButton:()=>ee(),brushBarButton:()=>Q(),dustBox:()=>ne(),wetRollerTray:()=>oe()};function q(e,o){if(!e)return console.warn("No action name provided for triggerModelAction."),!1;const t=document.querySelector(`[data-model-action="${e}"]`);if(t)return t.dispatchEvent(new Event("click",{bubbles:!0})),!0;const i=Y[e];return typeof i!="function"?(console.warn(`No handler found for action "${e}".`),!1):(i(o),!0)}window.Dyson3DControls={triggerAction:q,availableActions:()=>Object.keys(Y)};window.addEventListener("message",e=>{var n,r;const{data:o}=e;let t,i;if(typeof o=="string")t=o;else if(o&&typeof o=="object"){if(o.type&&o.type!=="MODEL_ACTION")return;t=(r=(n=o.action)!=null?n:o.modelAction)!=null?r:o.id,i=o.payload}typeof t=="string"&&q(t,i)});p.background=new a.Color(1118481);u.setSize(innerWidth,innerHeight);u.setPixelRatio(devicePixelRatio);u.domElement.id="myCanvas";document.body.appendChild(u.domElement);window.addEventListener("resize",()=>{const e=window.innerWidth,o=window.innerHeight;l.aspect=e/o,l.updateProjectionMatrix(),u.setSize(e,o),u.setPixelRatio(window.devicePixelRatio)});var d=new le(l,u.domElement);d.minDistance=.5;d.maxDistance=1;l.position.z=1.5;l.position.x=0;l.position.y=5;u.toneMapping=a.ACESFilmicToneMapping;u.toneMappingExposure=1.22;u.shadowMap.enabled=!0;u.outputColorSpace=a.SRGBColorSpace;let D=document.createElement("video");D.src="./glb/cordfree/LCD_battery.mp4";D.loop=!0;let O=new a.VideoTexture(D);O.format=a.RGBFormat;O.minFilter=a.NearestFilter;O.maxFilter=a.NearestFilter;O.generateMipmaps=!1;var Ie=new a.PlaneGeometry(.0271,.0271),Pe=new a.MeshBasicMaterial({map:O}),B=new a.Mesh(Ie,Pe);B.rotateX(0-Math.PI*.5);B.rotateZ(0-Math.PI*1);B.translateZ(.141);B.translateY(.146);const y=fe(p,u);y.ambient.intensity=k;y.ambient.color.setHex(me);const _e=new a.HemisphereLight(we,ye,he);p.add(_e);const F=new a.DirectionalLight(16777215,L*10);F.position.set(0,10,0);p.add(F);const G=new a.DirectionalLight(16777215,L*6);G.position.set(0,-10,0);p.add(G);const $=new a.DirectionalLight(16777215,L);$.position.set(-10,0,0);p.add($);const V=new a.DirectionalLight(16777215,L);V.position.set(10,0,0);p.add(V);const X=new a.DirectionalLight(16777215,L);X.position.set(0,0,10);p.add(X);const K=new a.DirectionalLight(16777215,L*.7);K.position.set(0,0,-10);p.add(K);y.key.intensity=0;y.fill.intensity=0;y.rim.intensity=0;ge.load(pe,e=>{e.scene.scale.x=T,e.scene.scale.y=T,e.scene.scale.z=T,p.add(e.scene),N=e.scene.getObjectByName(m("rotor brush null A")),I=e.scene.getObjectByName(m("rotor brush null B")),P=e.scene.getObjectByName(m("SB-430273_AA - WET ROLLER ASSY_43089")),x=e.scene.getObjectByName(m("SB-430272_AA - DUST BOX ASSY")),_=e.scene.getObjectByName(m("SB-430287_AA - TRACTION WHEEL ASSY_30408")),M=e.scene.getObjectByName(m("SB-430287_AA - TRACTION WHEEL ASSY_38412")),A=e.scene.getObjectByName(m("SB-430273_AA - WET ROLLER ASSY_37478")),H=e.scene.getObjectByName(m("SB-430275_AA - BRUSHBAR ASSY_22072")),e.scene.getObjectByName(m("SB-430279_AA - FRONT WHEEL ASSY_5505")),e.scene.getObjectByName(m("SB-430287_AA - TRACTION WHEEL ASSY_41617")),Me()});Z();function Z(){requestAnimationFrame(Z),z.render()}function h(e,o=16777215){e.traverse(t=>{if(t.isMesh){t.material=t.material.clone(),t.material.emissive=new a.Color(t.material.color),t.material.emissiveIntensity=0;const i=s.fromTo(t.material,{emissiveIntensity:5,duration:.8,ease:"sine.inOut"},{emissiveIntensity:0,duration:.8,ease:"sine.inOut"});Oe.set(t,i)}})}function Me(){s.to(y.key,{intensity:2,duration:1}),s.to(y.fill,{intensity:.5,duration:1,delay:.2}),s.to(y.rim,{intensity:1,duration:1,delay:.4}),s.to(y.ambient,{intensity:k,duration:1,delay:.6}),f.clear(),f.to(l.position,{id:"openingAnimation",duration:3,x:0,y:-1.5,z:1.75,ease:"power2.inOut",onUpdate:function(){d.update()}})}function m(e){return e.replace(/ /g,"_")}addEventListener("mousemove",e=>{e.clientX/innerWidth*2-1,-(e.clientY/innerHeight)*2+1});function E(){if(l.position.y>.1){const e=He(l);e.tweening?(console.log("Camera is tweening to:",e.target),e.target&&e.target.x===0&&e.target.y===-1.5&&e.target.z===1.75?console.log("Camera is tweening to starting position"):(f.clear(),f.to(l.position,{duration:1.5,x:0,y:-1.5,z:1.75,overwrite:"true",ease:"power1.inOut",onUpdate:function(){d.update()}}))):(console.log("Camera is idle."),f.clear(),f.to(l.position,{duration:1.5,x:0,y:-1.5,z:1.75,overwrite:"true",ease:"power1.inOut",onUpdate:function(){d.update()}}))}j()}function He(e){var t,i,n;const o=s.getTweensOf(e.position);for(const r of o)if(r.isActive()){const c=r.vars;return{tweening:!0,target:{x:(t=c.x)!=null?t:e.position.x,y:(i=c.y)!=null?i:e.position.y,z:(n=c.z)!=null?n:e.position.z}}}return{tweening:!1,target:null}}var S=document.querySelector('[data-model-action="dustBox"]');S==null||S.addEventListener("click",ne);var C=document.querySelector('[data-model-action="wetRollerTray"]');C==null||C.addEventListener("click",oe);Te.addEventListener("click",e=>{J(e)});function J(e){var t,i,n;const o=(n=(i=(t=e==null?void 0:e.currentTarget)==null?void 0:t.dataset)==null?void 0:i.modelAction)!=null?n:"sideCleanerButton";h(N,16711680),h(I),g(N,be,w,o,"y"),g(I,Re,w,o,"y",-1),E()}Be.addEventListener("click",e=>{Q(e)});function Q(e){var t,i,n;const o=(n=(i=(t=e==null?void 0:e.currentTarget)==null?void 0:t.dataset)==null?void 0:i.modelAction)!=null?n:"brushBarButton";h(H),g(H,Ee,w,o,"x"),E()}xe.addEventListener("click",e=>{ee(e)});function ee(e){var t,i,n;const o=(n=(i=(t=e==null?void 0:e.currentTarget)==null?void 0:t.dataset)==null?void 0:i.modelAction)!=null?n:"wetRollerButton";h(P),g(P,Ae,w,o,"x",-1,.75,.75,1.5),E()}Se.addEventListener("click",e=>{te(e)});function te(e){var t,i,n;const o=(n=(i=(t=e==null?void 0:e.currentTarget)==null?void 0:t.dataset)==null?void 0:i.modelAction)!=null?n:"wheelsButton";h(_),h(M),g(_,Ce,w,o,"x",1,1,1,3),g(M,Ne,w,o,"x",1,1,1,3),E()}function ne(e){var t,i,n;f.clear(),v.clear(),h(x);const o=(n=(i=(t=e==null?void 0:e.currentTarget)==null?void 0:t.dataset)==null?void 0:i.modelAction)!=null?n:"dustBox";b?(s.to(x.position,{duration:1.4,z:-300,ease:"power1.inOut",delay:.5}),f.to(l.position,{overwrite:"true",duration:1.5,x:-3,y:3,z:1,ease:"power1.inOut",onUpdate:function(){d.update()}}),v.to(d.target,{overwrite:"true",duration:1.5,x:0,y:.2,z:0,ease:"power1.inOut",onUpdate:function(){d.update()}}),w("spinning",o),b=!1):(s.to(x.position,{duration:1.75,z:0,ease:"power1.inOut"}),f.to(l.position,{overwrite:"true",duration:1.75,x:-6,y:3,z:1,ease:"power1.inOut",delay:0,onUpdate:function(){d.update()}}),j(),w("idle",o),b=!0)}function oe(e){var t,i,n;h(A),f.clear(),v.clear();const o=(n=(i=(t=e==null?void 0:e.currentTarget)==null?void 0:t.dataset)==null?void 0:i.modelAction)!=null?n:"wetRollerTray";R?(s.to(A.position,{duration:1.4,x:400,ease:"power1.inOut"}),f.to(l.position,{overwrite:"true",duration:1.5,x:-.4,y:4,z:1.4,ease:"power1.inOut",onUpdate:function(){d.update()}}),v.to(d.target,{overwrite:"true",duration:1.5,x:-.4,y:-.25,z:-.1,ease:"power1.inOut",onUpdate:function(){d.update()}}),w("spinning",o),R=!1):(s.to(A.position,{duration:1.2,x:0,ease:"power1.inOut"}),f.to(l.position,{overwrite:"true",duration:1.2,x:-6,y:3,z:1,ease:"power1.inOut",onUpdate:function(){d.update()}}),j(),w("idle",o),R=!0)}function j(e=1.5){v.clear(),v.to(d.target,{overwrite:"true",duration:e,x:0,y:0,z:0,ease:"power1.inOut",delay:0,onUpdate:function(){d.update()}})}function w(e,o){const t=document.querySelector(`[data-model-action="${o}"]`);if(!t)return;const i=t.querySelector(".circle");!i||(i.classList.remove("idle","spinning","decelerating"),i.classList.add(e))}
