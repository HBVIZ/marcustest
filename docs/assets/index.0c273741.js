import{gsap as c}from"https://esm.sh/gsap@3.12.2";import*as s from"https://esm.sh/three@0.157.0";import{GLTFLoader as J}from"https://esm.sh/three@0.157.0/examples/jsm/loaders/GLTFLoader.js";import{OrbitControls as Q}from"https://esm.sh/three@0.157.0/examples/jsm/controls/OrbitControls.js";import{EffectComposer as ee}from"https://esm.sh/three@0.157.0/examples/jsm/postprocessing/EffectComposer.js";import{RenderPass as te}from"https://esm.sh/three@0.157.0/examples/jsm/postprocessing/RenderPass.js";import{UnrealBloomPass as ne}from"https://esm.sh/three@0.157.0/examples/jsm/postprocessing/UnrealBloomPass.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();function v(e,n,t,a,o="x",i=1,r=.5,I=.5,X=.5){const Z=n.isActive(),K=n.paused();["x","y","z"].includes(o)||(console.warn(`Invalid axis "${o}" passed to toggleSpin. Defaulting to 'x'.`),o="x"),i=Math.sign(i)||1;const U=e.rotation[o];Z||!K?(n.clear().to(e.rotation,{[o]:U+i*Math.PI/2,duration:I,ease:"power1.out",onComplete:()=>{n.pause(),t("idle",a)}}).play(),t("decelerating",a)):(n.clear().to(e.rotation,{[o]:U+i*Math.PI,duration:r,ease:"power1.in"}).to(e.rotation,{[o]:`+=${i*Math.PI*2}`,duration:X,ease:"linear",repeat:-1}).play(),t("spinning",a))}function oe(e,n){const t=new s.DirectionalLight(16777215,2);t.position.set(5,10,10),t.castShadow=!0,e.add(t);const a=new s.DirectionalLight(16777215,.5);a.position.set(-5,2,5),e.add(a);const o=new s.DirectionalLight(16777215,1);o.position.set(0,5,-10),e.add(o);const i=new s.AmbientLight(4473924,.2);e.add(i);const r=new s.DirectionalLight(16777215,2);return r.position.set(0,-5,0),r.target.position.set(0,0,0),e.add(r),e.add(r.target),n.shadowMap.enabled=!0,{key:t,fill:a,rim:o,ambient:i,upLight:r}}const O=new s.Scene,l=new s.PerspectiveCamera(50,innerWidth/innerHeight,.01,1e3),u=new s.WebGLRenderer({antialias:!1});u.setPixelRatio(window.devicePixelRatio);u.setSize(innerWidth,innerHeight);const ie=new J,p=c.timeline({}),h=c.timeline({}),ae=new te(O,l),_=new ee(u);_.addPass(ae);const re=new ne(new s.Vector2(window.innerWidth,window.innerHeight),.5,1.4,.5);_.addPass(re);let se=new Map;var C,S,P,x,N,z,A,M;const ce=document.querySelector('[data-model-action="wetRollerButton"]'),le=c.timeline({paused:!0,repeat:-1,ease:"power1.inOut"}),de=document.querySelector('[data-model-action="brushBarButton"]'),ue=c.timeline({paused:!0,repeat:-1,ease:"power1.inOut"}),pe=document.querySelector('[data-model-action="sideCleanerButton"]'),me=c.timeline({paused:!0,repeat:-1,ease:"power1.inOut"}),fe=c.timeline({paused:!0,repeat:-1,ease:"power1.inOut"}),we=document.querySelector('[data-model-action="wheelsButton"]'),ye=c.timeline({paused:!0,repeat:-1,ease:"power1.inOut"}),ve=c.timeline({paused:!0,repeat:-1,ease:"power1.inOut"}),T=new Map,D={sideCleanerButton:e=>q(e),wheelsButton:e=>G(e),wetRollerButton:e=>Y(e),brushBarButton:e=>F(e),dustBox:e=>$(e),wetRollerTray:e=>V(e)};function B(e){return T.has(e)||T.set(e,{active:!1}),T.get(e)}function H(e,n){if(!e)return console.warn("No action name provided for triggerModelAction."),!1;const t=D[e];return typeof t!="function"?(console.warn(`No handler found for action "${e}".`),!1):(t(n!=null?n:{source:"external"}),!0)}window.Dyson3DControls={triggerAction:H,availableActions:()=>Object.keys(D)};window.addEventListener("message",e=>{var o,i;const{data:n}=e;let t,a;if(typeof n=="string")t=n;else if(n&&typeof n=="object"){if(n.type&&n.type!=="MODEL_ACTION")return;t=(i=(o=n.action)!=null?o:n.modelAction)!=null?i:n.id,a=n.payload}typeof t=="string"&&H(t,a)});O.background=new s.Color(1118481);u.setSize(innerWidth,innerHeight);u.setPixelRatio(devicePixelRatio);u.domElement.id="myCanvas";document.body.appendChild(u.domElement);window.addEventListener("resize",()=>{const e=window.innerWidth,n=window.innerHeight;l.aspect=e/n,l.updateProjectionMatrix(),u.setSize(e,n),u.setPixelRatio(window.devicePixelRatio)});var d=new Q(l,u.domElement);d.minDistance=.5;d.maxDistance=1;l.position.z=1.5;l.position.x=0;l.position.y=5;u.toneMapping=s.ACESFilmicToneMapping;u.toneMappingExposure=1.22;u.shadowMap.enabled=!0;u.outputColorSpace=s.SRGBColorSpace;let j=document.createElement("video");j.src="./glb/cordfree/LCD_battery.mp4";j.loop=!0;let g=new s.VideoTexture(j);g.format=s.RGBFormat;g.minFilter=s.NearestFilter;g.maxFilter=s.NearestFilter;g.generateMipmaps=!1;var he=new s.PlaneGeometry(.0271,.0271),Be=new s.MeshBasicMaterial({map:g}),E=new s.Mesh(he,Be);E.rotateX(0-Math.PI*.5);E.rotateZ(0-Math.PI*1);E.translateZ(.141);E.translateY(.146);const w=oe(O,u);w.key.intensity=0;w.fill.intensity=0;w.rim.intensity=0;w.ambient.intensity=0;ie.load("./glb/robot/804_A_test_001.glb",e=>{let n=1;e.scene.scale.x=n,e.scene.scale.y=n,e.scene.scale.z=n,O.add(e.scene),C=e.scene.getObjectByName(m("rotor brush null A")),S=e.scene.getObjectByName(m("rotor brush null B")),P=e.scene.getObjectByName(m("SB-430273_AA - WET ROLLER ASSY_43089")),x=e.scene.getObjectByName(m("SB-430272_AA - DUST BOX ASSY")),N=e.scene.getObjectByName(m("SB-430287_AA - TRACTION WHEEL ASSY_30408")),z=e.scene.getObjectByName(m("SB-430287_AA - TRACTION WHEEL ASSY_38412")),A=e.scene.getObjectByName(m("SB-430273_AA - WET ROLLER ASSY_37478")),M=e.scene.getObjectByName(m("SB-430275_AA - BRUSHBAR ASSY_22072")),e.scene.getObjectByName(m("SB-430279_AA - FRONT WHEEL ASSY_5505")),e.scene.getObjectByName(m("SB-430287_AA - TRACTION WHEEL ASSY_41617")),ge()});k();function k(){requestAnimationFrame(k),_.render()}function y(e,n=16777215){e.traverse(t=>{if(t.isMesh){t.material=t.material.clone(),t.material.emissive=new s.Color(t.material.color),t.material.emissiveIntensity=0;const a=c.fromTo(t.material,{emissiveIntensity:5,duration:.8,ease:"sine.inOut"},{emissiveIntensity:0,duration:.8,ease:"sine.inOut"});se.set(t,a)}})}function ge(){c.to(w.key,{intensity:2,duration:1}),c.to(w.fill,{intensity:.5,duration:1,delay:.2}),c.to(w.rim,{intensity:1,duration:1,delay:.4}),c.to(w.ambient,{intensity:.2,duration:1,delay:.6}),p.clear(),p.to(l.position,{id:"openingAnimation",duration:3,x:0,y:-1.5,z:1.75,ease:"power2.inOut",onUpdate:function(){d.update()}})}function m(e){return e.replace(/ /g,"_")}addEventListener("mousemove",e=>{e.clientX/innerWidth*2-1,-(e.clientY/innerHeight)*2+1});function b(){if(l.position.y>.1){const e=xe(l);e.tweening?(console.log("Camera is tweening to:",e.target),e.target&&e.target.x===0&&e.target.y===-1.5&&e.target.z===1.75?console.log("Camera is tweening to starting position"):(p.clear(),p.to(l.position,{duration:1.5,x:0,y:-1.5,z:1.75,overwrite:"true",ease:"power1.inOut",onUpdate:function(){d.update()}}))):(console.log("Camera is idle."),p.clear(),p.to(l.position,{duration:1.5,x:0,y:-1.5,z:1.75,overwrite:"true",ease:"power1.inOut",onUpdate:function(){d.update()}}))}W()}function xe(e){var t,a,o;const n=c.getTweensOf(e.position);for(const i of n)if(i.isActive()){const r=i.vars;return{tweening:!0,target:{x:(t=r.x)!=null?t:e.position.x,y:(a=r.y)!=null?a:e.position.y,z:(o=r.z)!=null?o:e.position.z}}}return{tweening:!1,target:null}}var L=document.querySelector('[data-model-action="dustBox"]');L==null||L.addEventListener("click",$);var R=document.querySelector('[data-model-action="wetRollerTray"]');R==null||R.addEventListener("click",V);pe.addEventListener("click",e=>{q(e)});function q(e){var o,i,r;const n=e instanceof Event,t=n&&(r=(i=(o=e.currentTarget)==null?void 0:o.dataset)==null?void 0:i.modelAction)!=null?r:"sideCleanerButton";(n||(e==null?void 0:e.source)==="external")&&(y(C,16711680),y(S));const a=B(t);v(C,me,f,t,"y"),v(S,fe,f,t,"y",-1),a.active=!a.active,b()}de.addEventListener("click",e=>{F(e)});function F(e){var o,i,r;const n=e instanceof Event,t=n&&(r=(i=(o=e.currentTarget)==null?void 0:o.dataset)==null?void 0:i.modelAction)!=null?r:"brushBarButton";(n||(e==null?void 0:e.source)==="external")&&y(M);const a=B(t);v(M,ue,f,t,"x"),a.active=!a.active,b()}ce.addEventListener("click",e=>{Y(e)});function Y(e){var o,i,r;const n=e instanceof Event,t=n&&(r=(i=(o=e.currentTarget)==null?void 0:o.dataset)==null?void 0:i.modelAction)!=null?r:"wetRollerButton";(n||(e==null?void 0:e.source)==="external")&&y(P);const a=B(t);v(P,le,f,t,"x",-1,.75,.75,1.5),a.active=!a.active,b()}we.addEventListener("click",e=>{G(e)});function G(e){var o,i,r;const n=e instanceof Event,t=n&&(r=(i=(o=e.currentTarget)==null?void 0:o.dataset)==null?void 0:i.modelAction)!=null?r:"wheelsButton";(n||(e==null?void 0:e.source)==="external")&&(y(N),y(z));const a=B(t);v(N,ye,f,t,"x",1,1,1,3),v(z,ve,f,t,"x",1,1,1,3),a.active=!a.active,b()}function $(e){var o,i,r;p.clear(),h.clear(),y(x);const t=e instanceof Event&&(r=(i=(o=e.currentTarget)==null?void 0:o.dataset)==null?void 0:i.modelAction)!=null?r:"dustBox",a=B(t);a.active?(c.to(x.position,{duration:1.75,z:0,ease:"power1.inOut"}),p.to(l.position,{overwrite:"true",duration:1.75,x:-6,y:3,z:1,ease:"power1.inOut",delay:0,onUpdate:function(){d.update()}}),W(),f("idle",t)):(c.to(x.position,{duration:1.4,z:-300,ease:"power1.inOut",delay:.5}),p.to(l.position,{overwrite:"true",duration:1.5,x:-3,y:3,z:1,ease:"power1.inOut",onUpdate:function(){d.update()}}),h.to(d.target,{overwrite:"true",duration:1.5,x:0,y:.2,z:0,ease:"power1.inOut",onUpdate:function(){d.update()}}),f("spinning",t)),a.active=!a.active}function V(e){var o,i,r;y(A),p.clear(),h.clear();const t=e instanceof Event&&(r=(i=(o=e.currentTarget)==null?void 0:o.dataset)==null?void 0:i.modelAction)!=null?r:"wetRollerTray",a=B(t);a.active?(c.to(A.position,{duration:1.2,x:0,ease:"power1.inOut"}),p.to(l.position,{overwrite:"true",duration:1.2,x:-6,y:3,z:1,ease:"power1.inOut",onUpdate:function(){d.update()}}),W(),f("idle",t)):(c.to(A.position,{duration:1.4,x:400,ease:"power1.inOut"}),p.to(l.position,{overwrite:"true",duration:1.5,x:-.4,y:4,z:1.4,ease:"power1.inOut",onUpdate:function(){d.update()}}),h.to(d.target,{overwrite:"true",duration:1.5,x:-.4,y:-.25,z:-.1,ease:"power1.inOut",onUpdate:function(){d.update()}}),f("spinning",t)),a.active=!a.active}function W(e=1.5){h.clear(),h.to(d.target,{overwrite:"true",duration:e,x:0,y:0,z:0,ease:"power1.inOut",delay:0,onUpdate:function(){d.update()}})}function f(e,n){const t=document.querySelector(`[data-model-action="${n}"]`);if(!t)return;const a=t.querySelector(".circle");!a||(a.classList.remove("idle","spinning","decelerating"),a.classList.add(e))}
